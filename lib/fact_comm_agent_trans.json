{
	"fct_comm_agent_trans": {
		"numPartitions": 68,
		"dim_prod_partition": "dim_prod_id",
		"dim_ln_of_bus_partition": "dim_ln_of_bus_id",
		"dim_policy_rider_partition": "dim_policy_rider_id",
		"dim_policy_partition": "dim_policy_id",
		"dim_comm_policy_partition": "dim_comm_policy_id",
		"dim_trans_partition": "dim_trans_id",
		"dim_agent_dist_chnl_partition": "dim_agent_dist_chnl_id",
		"dim_comm_trans_partition": "dim_comm_trans_id",
		"dim_agent_partition": "dim_agent_id",
		"dim_date_partition": "dim_dt_id",
		"fct_comm_agent_trans_partition": "fct_comm_agent_trans_id",
		"ods_query": "( select /*+ NO_INDEX(VCAPM UNIQ_ODS_VW_COMM_AGENT_PROFILE_MSTR) */ CAT.POLICY_MSTR_ID,CAT.POLICY_DUR, CAT.TRANS_MSTR_ID, CAT.PROC_YRMO, PM.SRC_SYS, trim(PM.POLICY_NUM) AS POLICY_NUM, PM.STAT_CO_CD, PM.CO_CD, PRM.SRC_CO_CD, PRM.PLAN_CD, case when PRM.PROD_TYP in ('FIA','FA') THEN 'FA' WHEN PRM.PROD_TYP IN ('IVA','VA') THEN 'VA' END AS PROD_TYPE, TM.ADR_CD, NVL(LOB.LN_OF_BUS_CD,'NULL') AS LN_OF_BUS_CD, VCAPM.AGENT_ID, VCAPM.AGENT_PROFILE_CD, CAT.AGENT_NUM_EARN AS AGENT_NUM_EARN,CAT.TRANS_PROC_DT, CAT.TRANS_EFF_DT, CAT.TRANS_RVSL_DT, CAT.POLICY_FILE_CD, CAT.AGENT_FILE_CD, CAT.PD_DT, CAT.PD_TO_DT,CAT.ORIG_TRANS_CD,CAT.COMM_RT, CAT.COMM_PCT_SPLIT, CAT.AMT_PD, CAT.REAL_PD_AMT, CAT.ABC_COMM_RT as ABC_RT, CAT.AGE_USED as AGE_USED_fOR_COMM_CALC, CAT.BASIS_AMT, CAT.CHRGBACK_EXCPT_AMT_USED_AMT, CAT.TRAIL_MO, CAT.DBA_DPST_YR, CAT.INIT_ADV_AMT, CAT.LBR_USED_IND, CAT.OFFST_RECOUP_TOT_AMT, CAT.RIGHT_OF_ACCUM_AMT, CAT.LBR_IND, ADR1.ADR_REF_CD AS RVSL_CD, NULL AS ABC_RT_TYP_CD, NULL AS ABC_VALTN_FREQ_CD, ADR2.ADR_REF_CD AS TRAIL_FREQ_CD, NULL AS TRAIL_TYP_CD, CAT.COMM_BASIS_RSN_CD, ADR3.ADR_REF_CD AS COMM_MTHD_CD, CAT.COMM_OPT_CD, ADR4.ADR_REF_CD AS COMPEN_RVRT_CD, ADR5.ADR_REF_CD AS HOLD_TYP_CD, NULL AS COMM_ADJMT_DESC, CAT.COMPEN_CAT, CAT.COMM_CALC_RULE, CAT.COMM_SRC, CAT.FREE_LOOK_CD, NULL AS MEMO_CD, -99 AS SCD_ID, {1} AS BTCH_ID, trunc(SYSDATE) AS CRTD_DT, NULL AS CRTD_BY, NULL AS MDFD_BTCH_ID, NULL AS MDFD_DT, NULL AS MDFD_BY from {0}.COMM_AGENT_TRANS CAT LEFT JOIN {0}.POLICY_MSTR PM ON CAT.POLICY_MSTR_ID=PM.POLICY_MSTR_ID LEFT JOIN {0}.PROD_MSTR PRM ON PM.PROD_MSTR_ID =PRM.PROD_MSTR_ID LEFT JOIN (select * from (SELECT ROW_NUMBER() OVER (Partition BY P.SRC_SYS,trim(polm.policy_num) ORDER BY P.SRC_SYS,P.POLICY_MSTR_ID,P.EFF_FROM_DT desc) as Row#,P.LN_OF_BUS_ID,P.POLICY_MSTR_ID,polm.policy_num,polm.src_sys FROM {0}.POLICY P inner join {0}.policy_mstr polm on p.policy_mstr_id=polm.policy_mstr_id) WHERE Row#=1) PLY ON trim(PM.POLICY_NUM)=trim(PLY.POLICY_NUM) and PLY.SRC_SYS=PM.SRC_SYS LEFT JOIN {0}.LOB_MSTR LOB ON LOB.LN_OF_BUS_MSTR_ID=PLY.LN_OF_BUS_ID LEFT JOIN {0}.TRANS_MSTR TM ON CAT.TRANS_MSTR_ID= TM.TRANS_MSTR_ID LEFT JOIN {0}.ODS_VW_COMM_AGENT_PROFILE_MSTR VCAPM ON CAT.WRT_AGENT_PROFILE_MSTR_ID =VCAPM.COMM_AGENT_PROFILE_MSTR_ID LEFT JOIN {0}.ADR_REF_VAL ADR1 on ADR1.REF_ID=CAT.RVSL_ID LEFT JOIN {0}.ADR_REF_VAL ADR2 on ADR2.REF_ID=CAT.TRAIL_FREQ_ID LEFT JOIN {0}.ADR_REF_VAL ADR3 on ADR3.REF_ID=CAT.COMM_MTHD_ID LEFT JOIN {0}.ADR_REF_VAL ADR4 on ADR4.REF_ID=CAT.COMPEN_RVRT_ID LEFT JOIN {0}.ADR_REF_VAL ADR5 on ADR5.REF_ID=CAT.HOLD_TYP_ID WHERE CAT.PROC_YRMO in (select distinct proc_yrmo from {0}.COMM_AGENT_TRANS where btch_id = {2}) and CAT.btch_id={2} )fcat" ,
		"ods_map": "('TRANS_MSTR_ID','decimal(19,0)','TRANS_MSTR_ID','decimal(19,0)')*('POLICY_MSTR_ID','decimal(19,0)','POLICY_MSTR_ID','decimal(19,0)')*('PROC_YRMO','decimal(6,0)','PROC_YRMO','decimal(6,0)')*('POLICY_DUR','decimal(6,0)','POLICY_DUR','decimal(6,0)')*('SRC_SYS','string','SRC_SYS','string')*('POLICY_NUM','string','POLICY_NUM','string')*('STAT_CO_CD','string','STAT_CO_CD','string')*('CO_CD','string','CO_CD','string')*('SRC_CO_CD','string','SRC_CO_CD','string')*('PLAN_CD','string','PLAN_CD','string')*('PROD_TYPE','string','PROD_TYP','string')*('ADR_CD','string','ADR_CD','string')*('LN_OF_BUS_CD','string','LN_OF_BUS_CD','string')*('AGENT_ID','string','AGENT_ID','string')*('AGENT_PROFILE_CD','string','AGENT_PROFILE_CD','string')*('AGENT_NUM_EARN','string','AGENT_NUM_EARN','string')*('TRANS_PROC_DT','timestamp','TRANS_PROC_DT','date')*('TRANS_EFF_DT','timestamp','TRANS_EFF_DT','date')*('TRANS_RVSL_DT','timestamp','TRANS_RVSL_DT','date')*('POLICY_FILE_CD','decimal(19,0)','POLICY_FILE_CD','decimal(19,0)')*('AGENT_FILE_CD','decimal(19,0)','AGENT_FILE_CD','decimal(19,0)')*('PD_DT','timestamp','COMM_PD_DT','date')*('PD_TO_DT','timestamp','COMM_PD_TO_DT','date')*('ORIG_TRANS_CD','string','ORIG_TRANS_CD','string')*('COMM_RT','decimal(21,6)','COMM_RT','decimal(21,6)')*('COMM_PCT_SPLIT','decimal(21,4)','COMM_PCT_SPLIT','decimal(21,4)')*('AMT_PD','decimal(21,2)','COMM_PD_AMT','decimal(21,2)')*('REAL_PD_AMT','decimal(21,2)','REAL_COMM_PD_AMT','decimal(21,2)')*('ABC_RT','decimal(21,6)','ABC_RT','decimal(21,6)')*('AGE_USED_fOR_COMM_CALC','decimal(6,0)','AGE_USED_fOR_COMM_CALC','decimal(6,0)')*('BASIS_AMT','decimal(21,2)','BASIS_AMT','decimal(21,2)')*('CHRGBACK_EXCPT_AMT_USED_AMT','decimal(21,2)','CHRGBACK_EXCPT_AMT','decimal(21,2)')*('TRAIL_MO','decimal(6,0)','TRAIL_MO','decimal(6,0)')*('DBA_DPST_YR','decimal(6,0)','DBA_DPST_YR','decimal(6,0)')*('INIT_ADV_AMT','decimal(21,2)','INIT_ADV_AMT','decimal(21,2)')*('OFFST_RECOUP_TOT_AMT','decimal(21,2)','OFFST_RECOP_TOT_AMT','decimal(21,2)')*('RIGHT_OF_ACCUM_AMT','decimal(21,2)','RIGHT_OF_ACCUM_AMT','decimal(21,2)')*('LBR_IND','string','AGENT_LBR_IND','string')*('LBR_USED_IND','string','AGENT_LBR_USED_IND','string')*('RVSL_CD','string','RVSL_CD','string')*('ABC_RT_TYP_CD','string','ABC_RT_TYP_CD','string')*('ABC_VALTN_FREQ_CD','string','ABC_VALTN_FREQ_CD','string')*('TRAIL_FREQ_CD','string','TRAIL_FREQ_CD','string')*('TRAIL_TYP_CD','string','TRAIL_TYP_CD','string')*('COMM_BASIS_RSN_CD','string','COMM_BASIS_RSN_CD','string')*('COMM_MTHD_CD','string','COMM_MTHD_CD','string')*('COMM_OPT_CD','string','COMM_OPT_CD','string')*('COMPEN_RVRT_CD','string','COMPEN_RVRT_CD','string')*('HOLD_TYP_CD','string','HOLD_TYP_CD','string')*('COMM_ADJMT_DESC','string','COMM_ADJMT_DESC','string')*('COMPEN_CAT','string','COMPEN_CAT','string')*('COMM_CALC_RULE','string','COMM_CALC_RULE','string')*('COMM_SRC','string','COMM_SRC','string')*('FREE_LOOK_CD','string','FREE_LOOK_CD','string')*('MEMO_CD','string','MEMO_CD','string')*('SCD_ID','decimal(6,0)','SCD_ID','decimal(6,0)')*('BTCH_ID','decimal(19,0)','BTCH_ID','decimal(19,0)')*('CRTD_DT','timestamp','CRTD_DT','date')*('CRTD_BY','string','CRTD_BY','string')*('MDFD_BTCH_ID','string','MDFD_BTCH_ID','string')*('MDFD_DT','timestamp','MDFD_DT','date')*('MDFD_BY','string','MDFD_BY','string')",
		"ods_select_fields": "'POLICY_MSTR_ID','POLICY_DUR','TRANS_MSTR_ID','PROC_YRMO','SRC_SYS','POLICY_NUM','STAT_CO_CD','CO_CD','SRC_CO_CD','PLAN_CD','PROD_TYP','ADR_CD','LN_OF_BUS_CD','AGENT_ID','AGENT_PROFILE_CD','AGENT_NUM_EARN','TRANS_PROC_DT','TRANS_EFF_DT','TRANS_RVSL_DT','POLICY_FILE_CD','AGENT_FILE_CD','COMM_PD_DT','COMM_PD_TO_DT','ORIG_TRANS_CD','COMM_RT','COMM_PCT_SPLIT','COMM_PD_AMT','REAL_COMM_PD_AMT','ABC_RT','AGE_USED_fOR_COMM_CALC','BASIS_AMT','CHRGBACK_EXCPT_AMT','TRAIL_MO','DBA_DPST_YR','INIT_ADV_AMT','OFFST_RECOP_TOT_AMT','RIGHT_OF_ACCUM_AMT','AGENT_LBR_IND','AGENT_LBR_USED_IND','RVSL_CD','ABC_RT_TYP_CD','ABC_VALTN_FREQ_CD','TRAIL_FREQ_CD','TRAIL_TYP_CD','COMM_BASIS_RSN_CD','COMM_MTHD_CD','COMM_OPT_CD','COMPEN_RVRT_CD','HOLD_TYP_CD','COMM_ADJMT_DESC','COMPEN_CAT','COMM_CALC_RULE','COMM_SRC','FREE_LOOK_CD','MEMO_CD','SCD_ID','BTCH_ID','CRTD_DT','CRTD_BY','MDFD_BTCH_ID','MDFD_DT','MDFD_BY'",
		"result_query": "select OV.PROC_YRMO, dcp.dim_comm_policy_id as dim_comm_policy_id,case when (dp.dim_policy_id is null and ov.src_sys='FWV') then {0} when (dp.dim_policy_id is null and ov.src_sys='CVT') then {1} ELSE dp.dim_policy_id end as dim_policy_id, dprd.dim_prod_id as DIM_PROD_ID, case when (lob.dim_ln_of_bus_id is null and ov.src_sys='FWV') then {4} when (lob.dim_ln_of_bus_id is null and ov.src_sys='CVT') then {5} ELSE lob.dim_ln_of_bus_id end as DIM_LOB_ID, case when (dpr.dim_policy_rider_id is null and ov.src_sys='FWV') then {6} when (dpr.dim_policy_rider_id is null and ov.src_sys='CVT') then {7} ELSE dpr.dim_policy_rider_id end as DIM_POLICY_DB_RIDER_ID, case when (lbr.dim_policy_rider_id is null and ov.src_sys='FWV') then {6} when (lbr.dim_policy_rider_id is null and ov.src_sys='CVT') then {7} ELSE lbr.dim_policy_rider_id end as DIM_POLICY_LBR_ID, case when (lb.dim_policy_rider_id is null and ov.src_sys='FWV') then {6} when (lb.dim_policy_rider_id is null and ov.src_sys='CVT') then {7} ELSE lb.dim_policy_rider_id end as DIM_POLICY_LB2_ID,CASE WHEN DA.dim_agent_id IS NULL THEN {9} ELSE DA.dim_agent_id END as DIM_WRT_AGENT_ID, CASE WHEN DA1.dim_agent_id IS NULL THEN {9} ELSE DA1.dim_agent_id END as DIM_COMM_AGENT_ID,case when DADC.dim_agent_dist_chnl_id is null then {8} Else DADC.dim_agent_dist_chnl_id  end as DIM_WRT_AGENT_DIST_CHNL_ID, case when DADC1.dim_agent_dist_chnl_id is null then {8} Else DADC1.dim_agent_dist_chnl_id end as DIM_COMM_AGENT_DIST_CHNL_ID,DCM.DIM_COMM_TRANS_ID AS DIM_COMM_TRANS_ID, DT.DIM_TRANS_ID AS DIM_TRANS_ID, DD.DIM_DT_ID AS TRANS_PROC_DIM_DT_ID, OV.TRANS_PROC_DT, DD1.DIM_DT_ID AS TRANS_EFF_DIM_DT_ID, OV.TRANS_EFF_DT, OV.TRANS_RVSL_DT, OV.POLICY_FILE_CD, OV.AGENT_FILE_CD, DD2.DIM_DT_ID AS COMM_PD_DIM_DT_ID, OV.COMM_PD_DT, OV.COMM_PD_TO_DT,OV.ORIG_TRANS_CD, OV.COMM_RT, OV.COMM_PCT_SPLIT, OV.COMM_PD_AMT, OV.REAL_COMM_PD_AMT, OV.ABC_RT, OV.AGE_USED_fOR_COMM_CALC, OV.BASIS_AMT, OV.CHRGBACK_EXCPT_AMT, OV.TRAIL_MO, OV.DBA_DPST_YR, OV.INIT_ADV_AMT, OV.OFFST_RECOP_TOT_AMT, OV.RIGHT_OF_ACCUM_AMT, OV.AGENT_LBR_IND, OV.AGENT_LBR_USED_IND, CASE WHEN DA.dim_agent_id IS NULL THEN {9} ELSE DA.dim_agent_id END ||'~'|| CASE WHEN DA1.dim_agent_id IS NULL THEN {9} ELSE DA1.dim_agent_id END ||'~'|| (case when (dp.dim_policy_id is null and ov.src_sys='FWV') then {0} when (dp.dim_policy_id is null and ov.src_sys='CVT') then {1} ELSE dp.dim_policy_id END )||'~'||dcp.dim_comm_policy_id as COMM_AGENT_TRANS_DISTN_KEY, OV.SCD_ID, OV.BTCH_ID, OV.CRTD_DT, OV.CRTD_BY, OV.MDFD_DT, OV.MDFD_BY,OV.POLICY_DUR  from ODS_VW ov left join DIM_COMM_POL dcp on ov.POLICY_NUM=dcp.admin_policy_num and ov.src_sys=dcp.admin_src_sys and ov.TRANS_PROC_DT BETWEEN dcp.eff_from_dt and dcp.eff_to_dt left join DIM_POLICY dp on ov.POLICY_NUM=dp.POLICY_NUM and ov.src_sys=dp.src_sys and ov.TRANS_PROC_DT BETWEEN dp.eff_from_dt and dp.eff_to_dt left join DIM_PROD dprd on ov.src_co_cd=dprd.src_co_cd and ov.plan_cd=dprd.plan_cd and ov.src_sys=dprd.src_sys left join DIM_LN_OF_BUS lob on nvl(ov.ln_of_bus_cd,'NULL')=nvl(lob.ln_of_bus,'NULL') and ov.src_sys=lob.src_sys left join (select * from DIM_POLICY_RIDER where RIDER_TYP='DBR') dpr ON ov.POLICY_NUM=dpr.POLICY_NUM and ov.src_sys=dpr.src_sys and ov.TRANS_PROC_DT BETWEEN dpr.eff_from_dt and dpr.eff_to_dt left join (SELECT * from DIM_POLICY_RIDER where RIDER_TYP='LBR') lbr ON ov.POLICY_NUM=lbr.POLICY_NUM and ov.src_sys=lbr.src_sys and ov.TRANS_PROC_DT BETWEEN lbr.eff_from_dt and lbr.eff_to_dt left join (SELECT * from DIM_POLICY_RIDER where RIDER_TYP='LB2') lb ON ov.POLICY_NUM=lb.POLICY_NUM and ov.src_sys=lb.src_sys and ov.TRANS_PROC_DT BETWEEN lb.eff_from_dt and lb.eff_to_dt left join DIM_AGENT DA ON ov.AGENT_ID=DA.AGENT_ID and ov.AGENT_PROFILE_CD=DA.AGENT_PROFILE_CD and ov.TRANS_PROC_DT BETWEEN DA.eff_from_dt and DA.eff_to_dt left join DIM_AGENT DA1 ON ov.AGENT_NUM_EARN=DA1.AGENT_ID||DA1.AGENT_PROFILE_CD and ov.TRANS_PROC_DT BETWEEN DA1.eff_from_dt and DA1.eff_to_dt left join DIM_AGENT_DIST_CHNL DADC ON ov.AGENT_ID=DADC.AGENT_ID and ov.AGENT_PROFILE_CD=DADC.AGENT_PROFILE_CD AND OV.PROD_TYP=DADC.PROD_TYP and ov.TRANS_PROC_DT BETWEEN DADC.eff_from_dt and DADC.eff_to_dt left join DIM_AGENT_DIST_CHNL DADC1 ON ov.AGENT_NUM_EARN=DADC1.AGENT_ID||DADC1.AGENT_PROFILE_CD AND OV.PROD_TYP=DADC1.PROD_TYP and ov.TRANS_PROC_DT BETWEEN DADC1.eff_from_dt and DADC1.eff_to_dt left join DIM_TRANS DT ON DT.TRANS_MSTR_ID=OV.TRANS_MSTR_ID left join DIM_DATE DD ON to_date(OV.TRANS_PROC_DT,'YYYYMMDD')=to_date(DD.FULL_DT,'YYYYMMDD') left join DIM_DATE DD1 ON to_date(OV.TRANS_EFF_DT,'YYYYMMDD')=to_date(DD1.FULL_DT,'YYYYMMDD') left join DIM_DATE DD2 ON to_date(OV.COMM_PD_DT,'YYYYMMDD')=to_date(DD2.FULL_DT,'YYYYMMDD') left join DIM_COMM_TRANS DCM ON NVL(DCM.RVSL_CD,'NULL')=NVL(OV.RVSL_CD,'NULL') and NVL(DCM.ABC_RT_TYP_CD,'NULL')= NVL(OV.ABC_RT_TYP_CD,'NULL') and NVL(DCM.ABC_VALTN_FREQ_CD,'NULL')= NVL(OV.ABC_VALTN_FREQ_CD,'NULL') and NVL(DCM.TRAIL_FREQ_CD,'NULL')= NVL(OV.TRAIL_FREQ_CD,'NULL') and NVL(DCM.TRAIL_TYP_CD,'NULL')= NVL(OV.TRAIL_TYP_CD,'NULL') and NVL(DCM.COMM_BASIS_RSN_CD,'NULL')= NVL(OV.COMM_BASIS_RSN_CD,'NULL') and NVL(DCM.COMM_MTHD_CD,'NULL')= NVL(OV.COMM_MTHD_CD,'NULL') and NVL(DCM.COMM_OPT_CD,'NULL')= NVL(OV.COMM_OPT_CD,'NULL') and NVL(DCM.COMPEN_RVRT_CD,'NULL')= NVL(OV.COMPEN_RVRT_CD,'NULL') and NVL(DCM.HOLD_TYP_CD,'NULL')= NVL(OV.HOLD_TYP_CD,'NULL') and NVL(DCM.COMM_ADJMT_DESC,'NULL')= NVL(OV.COMM_ADJMT_DESC,'NULL') and NVL(DCM.COMPEN_CAT,'NULL')= NVL(OV.COMPEN_CAT,'NULL') and NVL(DCM.COMM_CALC__RULE_CD,'NULL')= NVL(OV.COMM_CALC_RULE,'NULL') and NVL(DCM.COMM_SRC,'NULL')= NVL(OV.COMM_SRC,'NULL') and NVL(DCM.FREE_LOOK_CD,'NULL')= NVL(OV.FREE_LOOK_CD,'NULL') and NVL(DCM.MEMO_CD,'NULL')= NVL(OV.MEMO_CD,'NULL')",
		"map": "('PROC_YRMO','decimal(6,0)','PROC_YRMO','decimal(6,0)')*('POLICY_DUR','decimal(6,0)','POLICY_DUR','decimal(6,0)')*('dim_comm_policy_id','bigint','dim_comm_policy_id','decimal(19,0)')*('dim_policy_id','bigint','dim_policy_id','decimal(19,0)')*('DIM_PROD_ID','bigint','DIM_PROD_ID','decimal(19,0)')*('DIM_LOB_ID','bigint','DIM_LOB_ID','decimal(19,0)')*('DIM_POLICY_DB_RIDER_ID','bigint','DIM_POLICY_DB_RIDER_ID','decimal(19,0)')*('DIM_POLICY_LBR_ID','bigint','DIM_POLICY_LBR_ID','decimal(19,0)')*('DIM_POLICY_LB2_ID','bigint','DIM_POLICY_LB2_ID','decimal(19,0)')*('DIM_WRT_AGENT_ID','bigint','DIM_WRT_AGENT_ID','decimal(19,0)')*('DIM_COMM_AGENT_ID','bigint','DIM_COMM_AGENT_ID','decimal(19,0)')*('DIM_WRT_AGENT_DIST_CHNL_ID','bigint','DIM_WRT_AGENT_DIST_CHNL_ID','decimal(19,0)')*('DIM_COMM_AGENT_DIST_CHNL_ID','bigint','DIM_COMM_AGENT_DIST_CHNL_ID','decimal(19,0)')*('DIM_COMM_TRANS_ID','bigint','DIM_COMM_TRANS_ID','decimal(19,0)')*('DIM_TRANS_ID','bigint','DIM_TRANS_ID','decimal(19,0)')*('TRANS_PROC_DIM_DT_ID','bigint','TRANS_PROC_DIM_DT_ID','decimal(19,0)')*('TRANS_PROC_DT','date','TRANS_PROC_DT','date')*('TRANS_EFF_DIM_DT_ID','bigint','TRANS_EFF_DIM_DT_ID','decimal(19,0)')*('TRANS_EFF_DT','date','TRANS_EFF_DT','date')*('TRANS_RVSL_DT','date','TRANS_RVSL_DT','date')*('POLICY_FILE_CD','decimal(19,0)','POLICY_FILE_CD','decimal(19,0)')*('AGENT_FILE_CD','decimal(19,0)','AGENT_FILE_CD','decimal(19,0)')*('COMM_PD_DIM_DT_ID','bigint','COMM_PD_DIM_DT_ID','decimal(19,0)')*('COMM_PD_DT','date','COMM_PD_DT','date')*('COMM_PD_TO_DT','date','COMM_PD_TO_DT','date')*('ORIG_TRANS_CD','string','ORIG_TRANS_CD','string')*('COMM_RT','decimal(21,6)','COMM_RT','decimal(21,6)')*('COMM_PCT_SPLIT','decimal(21,4)','COMM_PCT_SPLIT','decimal(21,4)')*('COMM_PD_AMT','decimal(21,2)','COMM_PD_AMT','decimal(21,2)')*('REAL_COMM_PD_AMT','decimal(21,2)','REAL_COMM_PD_AMT','decimal(21,2)')*('ABC_RT','decimal(21,6)','ABC_RT','decimal(21,6)')*('AGE_USED_fOR_COMM_CALC','decimal(6,0)','AGE_USED_fOR_COMM_CALC','decimal(6,0)')*('BASIS_AMT','decimal(21,2)','BASIS_AMT','decimal(21,2)')*('CHRGBACK_EXCPT_AMT','decimal(21,2)','CHRGBACK_EXCPT_AMT','decimal(21,2)')*('TRAIL_MO','decimal(6,0)','TRAIL_MO','decimal(6,0)')*('DBA_DPST_YR','decimal(6,0)','DBA_DPST_YR','decimal(6,0)')*('INIT_ADV_AMT','decimal(21,2)','INIT_ADV_AMT','decimal(21,2)')*('OFFST_RECOP_TOT_AMT','decimal(21,2)','OFFST_RECOP_TOT_AMT','decimal(21,2)')*('RIGHT_OF_ACCUM_AMT','decimal(21,2)','RIGHT_OF_ACCUM_AMT','decimal(21,2)')*('AGENT_LBR_IND','string','AGENT_LBR_IND','string')*('AGENT_LBR_USED_IND','string','AGENT_LBR_USED_IND','string')*('COMM_AGENT_TRANS_DISTN_KEY','string','COMM_AGENT_TRANS_DISTN_KEY','string')*('SCD_ID','string','SCD_ID','string')*('BTCH_ID','decimal(19,0)','BTCH_ID','decimal(19,0)')*('CRTD_DT','date','CRTD_DT','date')*('CRTD_BY','string','CRTD_BY','string')*('MDFD_DT','date','MDFD_DT','date')*('MDFD_BY','string','MDFD_BY','string')",
		"select_fields": "'PROC_YRMO', 'dim_comm_policy_id', 'dim_policy_id', 'DIM_PROD_ID', 'DIM_LOB_ID', 'DIM_POLICY_DB_RIDER_ID', 'DIM_POLICY_LBR_ID', 'DIM_POLICY_LB2_ID', 'DIM_WRT_AGENT_ID', 'DIM_COMM_AGENT_ID', 'DIM_WRT_AGENT_DIST_CHNL_ID', 'DIM_COMM_AGENT_DIST_CHNL_ID', 'DIM_COMM_TRANS_ID', 'DIM_TRANS_ID', 'TRANS_PROC_DIM_DT_ID', 'TRANS_PROC_DT', 'TRANS_EFF_DIM_DT_ID', 'TRANS_EFF_DT', 'TRANS_RVSL_DT', 'POLICY_FILE_CD', 'AGENT_FILE_CD', 'COMM_PD_DIM_DT_ID', 'COMM_PD_DT', 'COMM_PD_TO_DT','ORIG_TRANS_CD', 'COMM_RT', 'COMM_PCT_SPLIT', 'COMM_PD_AMT', 'REAL_COMM_PD_AMT', 'ABC_RT', 'AGE_USED_fOR_COMM_CALC', 'BASIS_AMT', 'CHRGBACK_EXCPT_AMT', 'TRAIL_MO', 'DBA_DPST_YR', 'INIT_ADV_AMT', 'OFFST_RECOP_TOT_AMT', 'RIGHT_OF_ACCUM_AMT', 'AGENT_LBR_IND', 'AGENT_LBR_USED_IND', 'COMM_AGENT_TRANS_DISTN_KEY', 'SCD_ID', 'BTCH_ID', 'CRTD_DT', 'CRTD_BY', 'MDFD_DT', 'MDFD_BY','POLICY_DUR'",
		"final_query": "select FCAT.FCT_COMM_AGENT_TRANS_ID,DV.PROC_YRMO, DV.dim_comm_policy_id, DV.dim_policy_id, DV.DIM_PROD_ID, DV.DIM_LOB_ID, DV.DIM_POLICY_DB_RIDER_ID, DV.DIM_POLICY_LBR_ID, DV.DIM_POLICY_LB2_ID, DV.DIM_WRT_AGENT_ID, DV.DIM_COMM_AGENT_ID, DV.DIM_WRT_AGENT_DIST_CHNL_ID, DV.DIM_COMM_AGENT_DIST_CHNL_ID, DV.DIM_COMM_TRANS_ID, DV.DIM_TRANS_ID, DV.TRANS_PROC_DIM_DT_ID, DV.TRANS_PROC_DT, DV.TRANS_EFF_DIM_DT_ID, DV.TRANS_EFF_DT, DV.TRANS_RVSL_DT, DV.POLICY_FILE_CD, DV.AGENT_FILE_CD, DV.COMM_PD_DIM_DT_ID, DV.COMM_PD_DT, DV.COMM_PD_TO_DT,DV.ORIG_TRANS_CD, DV.COMM_RT,DV.COMM_PCT_SPLIT,DV.COMM_PD_AMT,DV.REAL_COMM_PD_AMT,DV.ABC_RT, DV.AGE_USED_fOR_COMM_CALC, DV.BASIS_AMT, DV.CHRGBACK_EXCPT_AMT, DV.TRAIL_MO, DV.DBA_DPST_YR, DV.INIT_ADV_AMT, DV.OFFST_RECOP_TOT_AMT, DV.RIGHT_OF_ACCUM_AMT, DV.AGENT_LBR_IND, DV.AGENT_LBR_USED_IND, DV.COMM_AGENT_TRANS_DISTN_KEY, DV.BTCH_ID, DV.CRTD_DT, '{0}' as CRTD_BY, DV.MDFD_DT, DV.MDFD_BY,DV.POLICY_DUR FROM DIM_VW DV LEFT JOIN FCT_COMM_AGENT_TRANS FCAT ON DV.PROC_YRMO=FCAT.PROC_YRMO and DV.dim_comm_policy_id=FCAT.dim_comm_policy_id and DV.DIM_POLICY_ID=FCAT.DIM_POLICY_ID and DV.DIM_PROD_ID=FCAT.DIM_PROD_ID and DV.DIM_LOB_ID=FCAT.DIM_LOB_ID and DV.DIM_POLICY_DB_RIDER_ID=FCAT.DIM_POLICY_DB_RIDER_ID and DV.DIM_POLICY_LBR_ID=FCAT.DIM_POLICY_LBR_ID and DV.DIM_POLICY_LB2_ID=FCAT.DIM_POLICY_LB2_ID and DV.DIM_WRT_AGENT_ID=FCAT.DIM_WRT_AGENT_ID and DV.DIM_COMM_AGENT_ID=FCAT.DIM_COMM_AGENT_ID and DV.DIM_WRT_AGENT_DIST_CHNL_ID=FCAT.DIM_WRT_AGENT_DIST_CHNL_ID and DV.DIM_COMM_AGENT_DIST_CHNL_ID=FCAT.DIM_COMM_AGENT_DIST_CHNL_ID and DV.DIM_COMM_TRANS_ID=FCAT.DIM_COMM_TRANS_ID and DV.DIM_TRANS_ID=FCAT.DIM_TRANS_ID and DV.TRANS_PROC_DIM_DT_ID=FCAT.TRANS_PROC_DIM_DT_ID and DV.TRANS_PROC_DT=FCAT.TRANS_PROC_DT and DV.TRANS_EFF_DIM_DT_ID=FCAT.TRANS_EFF_DIM_DT_ID and DV.TRANS_EFF_DT=FCAT.TRANS_EFF_DT and DV.TRANS_RVSL_DT=FCAT.TRANS_RVSL_DT and DV.POLICY_FILE_CD=FCAT.POLICY_FILE_CD and DV.AGENT_FILE_CD=FCAT.AGENT_FILE_CD and DV.COMM_PD_DIM_DT_ID=FCAT.COMM_PD_DIM_DT_ID where FCAT.FCT_COMM_AGENT_TRANS_ID  is null",
		"map_final": "('PROC_YRMO','decimal(6,0)','proc_yrmo','decimal(6,0)')*('POLICY_DUR','decimal(6,0)','policy_dur','decimal(6,0)')*('dim_comm_policy_id','decimal(19,0)','dim_comm_policy_id','decimal(19,0)')*('dim_policy_id','decimal(19,0)','dim_policy_id','decimal(19,0)')*('DIM_PROD_ID','decimal(19,0)','dim_prod_id','decimal(19,0)')*('DIM_LOB_ID','decimal(19,0)','dim_lob_id','decimal(19,0)')*('DIM_POLICY_DB_RIDER_ID','decimal(19,0)','dim_policy_db_rider_id','decimal(19,0)')*('DIM_POLICY_LBR_ID','decimal(19,0)','dim_policy_lbr_id','decimal(19,0)')*('DIM_POLICY_LB2_ID','decimal(19,0)','dim_policy_lb2_id','decimal(19,0)')*('DIM_WRT_AGENT_ID','decimal(19,0)','dim_wrt_agent_id','decimal(19,0)')*('DIM_COMM_AGENT_ID','decimal(19,0)','dim_comm_agent_id','decimal(19,0)')*('DIM_WRT_AGENT_DIST_CHNL_ID','decimal(19,0)','dim_wrt_agent_dist_chnl_id','decimal(19,0)')*('DIM_COMM_AGENT_DIST_CHNL_ID','decimal(19,0)','dim_comm_agent_dist_chnl_id','decimal(19,0)')*('DIM_COMM_TRANS_ID','decimal(19,0)','dim_comm_trans_id','decimal(19,0)')*('DIM_TRANS_ID','decimal(19,0)','dim_trans_id','decimal(19,0)')*('TRANS_PROC_DIM_DT_ID','decimal(19,0)','trans_proc_dim_dt_id','decimal(19,0)')*('TRANS_PROC_DT','date','trans_proc_dt','date')*('TRANS_EFF_DIM_DT_ID','decimal(19,0)','trans_eff_dim_dt_id','decimal(19,0)')*('TRANS_EFF_DT','date','trans_eff_dt','date')*('TRANS_RVSL_DT','date','trans_rvsl_dt','date')*('POLICY_FILE_CD','decimal(19,0)','policy_file_cd','decimal(19,0)')*('AGENT_FILE_CD','decimal(19,0)','agent_file_cd','decimal(19,0)')*('COMM_PD_DIM_DT_ID','decimal(19,0)','comm_pd_dim_dt_id','decimal(19,0)')*('COMM_PD_DT','date','comm_pd_dt','date')*('COMM_PD_TO_DT','date','comm_pd_to_dt','date')*('ORIG_TRANS_CD','string','ORIG_TRANS_CD','string')*('COMM_RT','decimal(21,6)','comm_rt','decimal(21,6)')*('COMM_PCT_SPLIT','decimal(21,4)','comm_pct_split','decimal(21,4)')*('COMM_PD_AMT','decimal(21,2)','comm_pd_amt','decimal(21,2)')*('REAL_COMM_PD_AMT','decimal(21,2)','real_comm_pd_amt','decimal(21,2)')*('ABC_RT','decimal(21,6)','abc_rt','decimal(21,6)')*('AGE_USED_fOR_COMM_CALC','decimal(6,0)','age_used_for_comm_calc','decimal(6,0)')*('BASIS_AMT','decimal(21,2)','basis_amt','decimal(21,2)')*('CHRGBACK_EXCPT_AMT','decimal(21,2)','chrgback_excpt_amt','decimal(21,2)')*('TRAIL_MO','decimal(6,0)','trail_mo','decimal(6,0)')*('DBA_DPST_YR','decimal(6,0)','dba_dpst_yr','decimal(6,0)')*('INIT_ADV_AMT','decimal(21,2)','init_adv_amt','decimal(21,2)')*('OFFST_RECOP_TOT_AMT','decimal(21,2)','offst_recop_tot_amt','decimal(21,2)')*('RIGHT_OF_ACCUM_AMT','decimal(21,2)','right_of_accum_amt','decimal(21,2)')*('AGENT_LBR_IND','string','agent_lbr_ind','string')*('AGENT_LBR_USED_IND','string','agent_lbr_used_ind','string')*('COMM_AGENT_TRANS_DISTN_KEY','string','comm_agent_trans_distn_key','string')*('BTCH_ID','decimal(19,0)','btch_id','decimal(19,0)')*('CRTD_DT','date','crtd_dt','date')*('CRTD_BY','string','crtd_by','string')*('MDFD_DT','date','mdfd_dt','date')*('MDFD_BY','string','mdfd_by','string')",
		"select_final_fields": "'proc_yrmo','policy_dur','dim_comm_policy_id','dim_policy_id','dim_prod_id','dim_lob_id','dim_policy_db_rider_id','dim_policy_lbr_id','dim_policy_lb2_id','dim_wrt_agent_id','dim_comm_agent_id','dim_wrt_agent_dist_chnl_id','dim_comm_agent_dist_chnl_id','dim_comm_trans_id','dim_trans_id','trans_proc_dim_dt_id','trans_proc_dt','trans_eff_dim_dt_id','trans_eff_dt','trans_rvsl_dt','policy_file_cd','agent_file_cd','comm_pd_dim_dt_id','comm_pd_dt','comm_pd_to_dt','ORIG_TRANS_CD','comm_rt','comm_pct_split','comm_pd_amt','real_comm_pd_amt','abc_rt','age_used_for_comm_calc','basis_amt','chrgback_excpt_amt','trail_mo','dba_dpst_yr','init_adv_amt','offst_recop_tot_amt','right_of_accum_amt','agent_lbr_ind','agent_lbr_used_ind','comm_agent_trans_distn_key','btch_id','crtd_dt','crtd_by','mdfd_dt','mdfd_by'",
		"dim_comm_pol_fltr": "(select dp.dim_comm_policy_id,dp.admin_policy_num, dp.admin_src_sys, dp.admin_stat_co_cd,case when dp.eff_from_dt = min(dp.eff_from_dt) over(partition by dp.admin_src_sys,dp.admin_policy_num,dp.admin_stat_co_cd) then '1900-01-01' else dp.eff_from_dt end as eff_from_dt, dp.eff_to_dt as eff_to_dt from {0}.dim_comm_policy dp inner join (select admin_policy_num,admin_src_sys,admin_stat_co_cd from (select row_number() over(partition by admin_policy_num, admin_src_sys order by eff_from_dt desc ,eff_to_dt desc ) as rnk, policy_mstr_id,admin_policy_num,admin_src_sys,admin_stat_co_cd,eff_From_dt,eff_to_dt from {0}.dim_comm_policy ) a where a.rnk=1) d on dp.admin_policy_num=d.admin_policy_num and dp.admin_src_sys=d.admin_src_sys and dp.admin_stat_co_cd=d.admin_stat_co_cd) t1",
		"dim_pol_fltr": "(select dp.dim_policy_id,dp.policy_num, dp.src_sys, dp.stat_co_cd,case when dp.eff_from_dt = min(dp.eff_from_dt) over(partition by dp.src_sys,dp.policy_num,dp.stat_co_cd) then '1900-01-01' else dp.eff_from_dt end as eff_from_dt, dp.eff_to_dt as eff_to_dt from {0}.dim_policy dp inner join (select policy_num,src_sys,stat_co_cd from (select row_number() over(partition by policy_num, src_sys order by eff_from_dt desc ,eff_to_dt desc ) as rnk, policy_mstr_id,policy_num,src_sys,stat_co_cd,eff_From_dt,eff_to_dt from {0}.dim_policy ) a where a.rnk=1) d on dp.policy_num=d.policy_num and dp.src_sys=d.src_sys and dp.stat_co_cd=d.stat_co_cd) t2",
		"dim_prod_fltr": "(SELECT * FROM {0}.dim_prod) t3",
		"dim_ln_of_bus_filter": "(SELECT * FROM {0}.DIM_LN_OF_BUS) t4",
		"dim_policy_rider_filter": "(select b.dim_policy_rider_id,b.policy_num,b.src_sys,b.rider_typ,b.eff_from_dt,b.eff_to_dt from (select a.*, row_number() over(partition by a.policy_num,a.src_sys,a.rider_typ,a.eff_from_dt order by eff_to_dt) as TRNK from (select dim_policy_rider_id,policy_num,src_sys,rider_typ,case when eff_from_dt = min(eff_from_dt) over(partition by policy_num,src_sys,rider_typ) then '1900-01-01' else eff_from_dt end as eff_from_dt, eff_to_dt from {0}.DIM_POLICY_RIDER) a) b where b.TRNK=1) t5",
		"dim_agent_filter": "(select a.* from (select distinct dag.dim_agent_id,dag.agent_id,dag.agent_profile_cd,row_number() over(partition by dag.agent_id, dag.agent_profile_cd,dag.eff_from_dt order by dag.agent_profile_term_dt desc,dag.eff_to_dt desc) as rnk,case when dag.eff_from_dt = min(dag.eff_from_dt) over(partition by dag.agent_id,dag.agent_profile_cd) then '1900-01-01' else dag.eff_from_dt end as eff_from_dt, dag.eff_to_dt as eff_to_dt from {0}.dim_agent dag inner join (select agent_id, agent_profile_cd,agent_profile_term_dt from (select row_number() over(partition by agent_id, agent_profile_cd,eff_from_dt order by agent_profile_term_dt desc) as rnk, dim_agent_id,agent_id,agent_profile_cd,agent_profile_term_dt,eff_from_dt,eff_to_dt from {0}.dim_agent) ag where ag.rnk=1) agent on dag.agent_id=agent.agent_id and dag.agent_profile_cd=agent.agent_profile_cd and dag.agent_profile_term_dt=agent.agent_profile_term_dt) a where a.rnk=1) t6",
		"dim_trans_filter": "(select * from {0}.DIM_TRANS ) t7",
		"dim_comm_trans_filter": "(select * from {0}.DIM_COMM_TRANS) t8",
		"dim_date_filter": "(select * from {0}.DIM_DT) t9",
		"dim_agent_dist_chnl_filter": "(select dim_agent_dist_chnl_id, AGENT_ID, AGENT_PROFILE_CD, PROD_TYP, case when eff_from_dt= min(eff_from_dt) over(partition by  AGENT_ID, AGENT_PROFILE_CD, PROD_TYP) then '1900-01-01' else eff_from_dt end as eff_from_dt, eff_to_dt from {0}.dim_agent_dist_chnl) t10",
		"fct_comm_agent_trans_filter": "(select * from {0}.FCT_COMM_AGENT_TRANS ) t11",
		"post-actions": "insert into {0}.abc_mart_aud_sumry (batch_id,job_mstr_id,etl_name,start_time,end_time,run_stat,src_cnt,tgt_cnt,rej_cnt,ld_dttm,start_time_str,end_time_str,ld_dttm_str) VALUES ({1},(select job_mstr_id from {0}.abc_mart_job_mastr where job_nm='{3}'),'{3}',TO_TIMESTAMP('{4}','YYYY-MM-DD HH24:MI:SS'),getdate(),'C',{5}, (select count(1) from {0}.fct_comm_agent_trans where btch_id={1}),0,getdate(),TO_CHAR(TO_TIMESTAMP('{4}','YYYY-MM-DD HH24:MI:SS'),'YYYYMMDD'),to_char(getdate(),'YYYYMMDD'),to_char(getdate(),'YYYYMMDD'));",
		"dup_check":"delete from {0}.fct_comm_agent_trans where fct_comm_agent_trans_id in (select del.fct_comm_agent_trans_id from (select row_number() over(partition by a.proc_yrmo,p.admin_policy_num,p.admin_src_sys, ag.agent_id,ag.agent_profile_cd, ag1.agent_id,ag1.agent_profile_cd,tr.trans_mstr_id, a.trans_proc_dt, a.policy_file_cd, a.agent_file_cd order by a.crtd_dt desc, a.trans_rvsl_dt desc) as rnk,a.fct_comm_agent_trans_id from {0}.fct_comm_agent_trans a inner join sa_adr_dw.dim_comm_policy p on a.dim_comm_policy_id=p.dim_comm_policy_id inner join {0}.dim_agent ag on ag.dim_agent_id=a.dim_comm_agent_id inner join {0}.dim_agent ag1 on ag1.dim_agent_id=a.dim_wrt_agent_id inner join {0}.dim_trans tr on tr.dim_trans_id=a.dim_trans_id ) del where del.rnk>1 )"

	}
}
